<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lh.mapper.ReplyMapper">

    <resultMap id="ReplyResultMap" type="com.lh.pojo.Reply">
        <id property="id" column="id" />
        <result property="content" column="content" />
        <result property="create_date" column="create_date" />
        <association property="user_id" resultMap="UserResultMap" />
        <association property="post_id" resultMap="PostResultMap" />
    </resultMap>

    <resultMap id="PostResultMap" type="com.lh.pojo.Post">
        <id property="id" column="post_id" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="create_date" column="create_date" />
        <result property="image_path" column="image_path" />
        <association property="user_id" resultMap="UserResultMap" />
    </resultMap>

    <resultMap id="UserResultMap" type="com.lh.pojo.User">
        <id property="id" column="user_id" />
        <result property="username" column="username" />
        <result property="password" column="password" />
        <result property="email" column="email" />
        <result property="role" column="role" />
        <result property="address" column="address" />
    </resultMap>

    <insert id="insertReply" parameterType="com.lh.pojo.Reply">
        insert into t_reply(user_id,post_id,create_date,content)
        values(#{user_id.id},#{post_id.id},#{create_date},#{content})
    </insert>
    <select id="findAllReply" resultMap="ReplyResultMap">
        select *
        from t_reply r,t_user u,t_post p
        where r.user_id=u.id and r.post_id=p.id
    </select>
    <select id="findReplyByID"  parameterType="Integer" resultMap="ReplyResultMap">
        select *
        from t_reply r,t_user u,t_post p
        where r.user_id=u.id and r.post_id=p.id and r.id=#{id}
    </select>
    <select id="findReplyByPID"  parameterType="Integer" resultMap="ReplyResultMap">
        select *
        from t_reply r,t_user u,t_post p
        where r.user_id=u.id and r.post_id=p.id and p.id=#{id}
    </select>
    <update id="updateReply" parameterType="com.lh.pojo.Reply">
        update t_reply
        set
            content = #{content},
            create_date = #{create_date}
        where
            id = #{id}
    </update>
    <delete id="deleteReplyByID" parameterType="integer">
        delete
        from t_reply
        where id=#{id}
    </delete>
    <select id="findReplyByStr" parameterType="java.lang.String" resultMap="ReplyResultMap">
        select *
        from t_reply r,t_user u,t_post p
        where r.user_id=u.id and r.post_id=p.id
        <if test="searchStr!=null and searchStr!=''">
            and (r.content like CONCAT('%',#{searchParam},'%')
            or p.title like CONCAT('%',#{searchParam},'%')
            or u.username like CONCAT('%',#{searchParam},'%'))
        </if>
    </select>
</mapper>